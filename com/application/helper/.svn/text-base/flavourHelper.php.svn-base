<?php class flavourHelper {	function __construct($apps){		global $logger;		$this->logger = $logger;		$this->apps = $apps;		if(is_object($this->apps->user)) {				$uid = intval($this->apps->_request('uid'));				if($uid==0) $this->uid = intval($this->apps->user->id);				else $this->uid = $uid;		}		$this->dbshema = "soursally_microweb_2014";			$this->topclass = array(100,4,6);	}	function checkYoggyUser(){		$sql = "SELECT MAX(datetimes) FROM user_flavors 				WHERE userid={$this->uid}				AND DATE_FORMAT(datetimes,'%m-%d-%Y') = DATE_FORMAT(NOW(),'%m-%d-%Y')				LIMIT 1";		$rs = $this->apps->fetch($sql);		return $rs;	}		function flavorList(){			$sql = "SELECT * FROM flavour WHERE n_status = 1";		$qData = $this->apps->fetch($sql,1);				$list =  array();		$default_list = array();		foreach ($qData as $key => $value) {			if(!isset($list[$value['categories']])) $default_list[$value['categories']]=$value;			$list[$value['categories']][]=$value;		}		foreach ($list as $key => $value) {			$tl = sizeof($list[$key]);			foreach ($value as $k => $val) {				$list[$key][$k]['total'] = $tl-1;			}		}		$data = array('list'=>$list,'default_list'=>$default_list);		//pr($data);exit;		if($qData) return $data;			else return false;		}		function addthedata(array $img){				$flavor_list = array();		$flavor_list[] = intval($this->apps->_p('cat_1'));		$flavor_list[] = intval($this->apps->_p('cat_2'));		$flavor_list[] = intval($this->apps->_p('cat_3'));		$flavor_list[] = intval($this->apps->_p('cat_4'));		$f_serialize = serialize($flavor_list);				$flavor_name = strip_tags($this->apps->_p('flavor_name'));		$submit = intval($this->apps->_p('save_flavor'));				if(isset($submit)){			$sql = "INSERT INTO user_flavors (`userid`,`name`, `flavor_list`, `flavor_img`,`flavor_img_share`, `datetimes`, `n_status`)					VALUES ({$this->uid}, '{$flavor_name}','{$f_serialize}','{$img['basic']}','{$img['share']}', NOW(), 1) ";			$res = $this->apps->query($sql);						if ($res) {				$dataselected = $this->listadedflavor($this->apps->getLastInsertId());				return $dataselected;			}			return false;		}		return false;	}		function listadedflavor($id=null,$userid=null){				if($userid) $filter_user = "AND uf.userid={$userid}";		else $filter_user = "";		$sql = "SELECT uf.*, sm.fbId, sm.name AS fb_name 				FROM user_flavors uf				LEFT JOIN social_member sm				ON sm.id = uf.userid				WHERE uf.id={$id} {$filter_user} LIMIT 1";		$qdata = $this->apps->fetch($sql);		$flavor_list = unserialize($qdata['flavor_list']);		$flavor_list = implode(',', $flavor_list);		$sql = "SELECT * FROM flavour				WHERE id IN ({$flavor_list}) LIMIT 4";		$rs = $this->apps->fetch($sql,1);		$arrange = array();		foreach ($rs as $key => $value) {			$arrange[$value['categories']] = $value;		}		ksort($arrange);		//pr($arrange);exit;		if($qdata) return array('flavour_chosen'=>$arrange,'desc'=>$qdata);		return false;	}	function prevFlavour($id=null)		{			$sql="SELECT id,userid FROM user_flavors where  id = (select max(id) from user_flavors where id < {$id})";			$qdata = $this->apps->fetch($sql);			return $qdata;				}	function nextFlavour($id=null)		{			$sql="SELECT id,userid FROM user_flavors where  id = (select min(id) from user_flavors where id > {$id})";			$qdata = $this->apps->fetch($sql);			return $qdata;				}	function galleryFlavour(array $conditional){		$start = 0;		$limit = 6;		if(sizeof($conditional)>0){			$start = $conditional['start'];		}		$sql = "SELECT COUNT(1) total				FROM user_flavors				WHERE n_status=1 LIMIT 1";		$total = $this->apps->fetch($sql);		$sql = "SELECT uf.*, sm.fbId, sm.name AS fb_name				FROM user_flavors uf				LEFT JOIN social_member sm				ON sm.id = uf.userid				WHERE uf.n_status=1				ORDER BY uf.id DESC LIMIT {$start},{$limit}";		$rs = $this->apps->fetch($sql,1);				return array('status'=>1,'data'=>$rs,'total'=>$total['total']);	}	function storevotedata(){	// pr($_POST);			$usr_flavor_id = $this->apps->_p('flavorid');		$userid = $this->uid;		$voted_date = date("Y-m-d H:i:s");		$n_status = 2; 				$sql = "INSERT INTO user_votes (`usr_flavor_id`, `userid`, `voted_date`, `n_status`) 				VALUES('{$usr_flavor_id}', '{$userid}', '{$voted_date}', '{$n_status}')";				// pr($sql);exit;		$res = $this->apps->query($sql);			}	}?>